# Конфигурация iHeater для Klipper

Данный репозиторий содержит конфигурационные файлы для нагревателя камеры 3D-принтера iHeater на основе прошивки Klipper и одноименной платы управления. Конфигурация предназначена для управления нагревом камеры и вентиляторами с помощью микроконтроллера RP2040 (например, Raspberry Pi Pico).

## Оглавление

- [Требования](#требования)
- [Подготовка](#подготовка)
- [Установка прошивки на RP2040](#установка-прошивки-на-rp2040)
- [Конфигурация Klipper](#конфигурация-klipper)
  - [Подключение MCU `iHeater`](#подключение-mcu-iheater)
  - [Настройка нагревателя `iHeater_H`](#настройка-нагревателя-iheater_h)
  - [Настройка вентилятора `iHeater_F1`](#настройка-вентилятора-iheater_f1)
  - [Настройка датчиков температуры](#настройка-датчиков-температуры)
  - [Макросы G-кода](#макросы-g-кода)
- [Использование](#использование)
  - [Команды управления нагревом камеры](#команды-управления-нагревом-камеры)
  - [Автоматизация и логика управления](#автоматизация-и-логика-управления)
- [Примечания](#примечания)
- [Лицензия](#лицензия)

## Требования

- **Аппаратное обеспечение:**
  - Микроконтроллер на базе RP2040 (например, Raspberry Pi Pico)
  - Терморезисторы NTC 100K MGB18-104F39050L32 (2 шт.)
  - Нагревательный элемент для камеры
  - Вентилятор для циркуляции воздуха в камере
  - Соответствующие электронные компоненты для подключения (резисторы, транзисторы, реле и т.д.)

- **Программное обеспечение:**
  - Klipper (последняя версия)
  - Плата Raspberry Pi или другое устройство для запуска Klipper
  - Настроенный и работающий 3D-принтер с Klipper

## Подготовка

1. **Сборка аппаратной части:**
   - Подключите нагревательный элемент и вентиляторы к микроконтроллеру RP2040.
   - Установите терморезисторы в камере и подключите их к соответствующим пинам MCU.
   - Убедитесь в правильности подключения пинов согласно конфигурационному файлу.

2. **Установка необходимых файлов:**
   - Скопируйте файлы `rp2040_pin_aliases.cfg` и `search_vars.cfg` в директорию конфигурации Klipper.

## Установка прошивки на RP2040

1. **Соберите прошивку Klipper для RP2040:**

   ```bash
   cd klipper/
   make menuconfig


**В меню конфигурации выберите:**

 - Micro-controller Architecture: RP2040
 - Processor model: rp2040
 - Остальные настройки оставьте по умолчанию.

**Сохраните и выйдите из меню.**

2. **Скомпилируйте прошивку:**

        make

3. ##Установка прошивки на RP2040:##

- Подключите RP2040 к компьютеру в режиме программирования (удерживая кнопку BOOTSEL при подключении).

- Смонтируйте устройство и загрузите прошивку:

        sudo mount /dev/sda1 /mnt
        sudo cp out/klipper.uf2 /mnt
        sudo umount /mnt

> **Примечание:** Замените /dev/sda1 на соответствующий путь к вашему устройству.

##Конфигурация Klipper

Скопируйте конфигурационные файлы iHeaterMCU.cfg и rp2040_pin_aliases.cfg в папку с printer.cfg и включите его с помощью директивы [include].
        
        [include iHeater.cfg]


## Использование
Команды управления нагревом камеры
- Установка температуры камеры:



        M141 S60  ; Устанавливает температуру камеры на 60°C

- Ожидание достижения температуры:

        M191 S60  ; Ждет, пока температура камеры достигнет 60°C

- Остановка нагрева камеры:

        M141 S0   ; Отключает нагрев камеры


## Автоматизация и логика управления
Макрос _iHEATER_CONTROL автоматически управляет вентилятором в зависимости от температуры камеры.
При достижении температуры 50°C вентилятор iHeater_F включается.
Макросы можно настроить под свои требования, изменив пороговые значения и логику.


## Примечания
- Безопасность:

    - Убедитесь, что все подключения выполнены правильно и безопасно.
    - Проверьте, что значения min_temp и max_temp соответствуют спецификациям оборудования.

- Проверка оборудования:
    - Перед использованием протестируйте работу нагревателя и вентилятора.
    - Следите за температурой во время первых запусков.
- Настройка PID:
    - При необходимости выполните калибровку PID для точного контроля температуры.


## Лицензия
Данный проект распространяется под лицензией MIT. Подробности смотрите в файле LICENSE.


>** Внимание: Использование нагревательных элементов и управление температурой связано с риском возгорания и повреждения оборудования. Всегда следуйте рекомендациям производителя и соблюдайте меры предосторожности.